---
import { Image } from "astro:assets";
import banderaSpanol from "../assets/logo/iconosLanguajes/spanol.webp"; 
import banderaEngland from "../assets/logo/iconosLanguajes/eeuu.webp";

const currentPath = Astro.url.pathname;
const currentLocale = Astro.currentLocale ?? (Astro.url.pathname.startsWith('/en') ? 'en' : 'es');
const isSpanish = currentLocale === 'es';
const targetLocale = isSpanish ? 'en' : 'es';
const targetLabel = isSpanish ? 'EN' : 'ES';

const targetFlag = isSpanish ? banderaEngland : banderaSpanol; 

const routeMap: Record<string, string> = {
  '/habitaciones': '/rooms',
  '/restaurante': '/restaurant',
  '/masajes': '/massage',
  '/galeria': '/gallery',
  '/contacto': '/contact',
  '/hotel': '/hotel',
};

const getReverseRoute = (path: string) => {
  return Object.entries(routeMap).find(([es, en]) => en === path)?.[0] || path;
};

const getTargetLink = () => {
  const cleanPath = currentPath.replace(/^\/en(\/|$)/, '/') || '/';
  
  if (targetLocale === 'en') {
    const enPath = routeMap[cleanPath] || cleanPath;
    return `/en${enPath}`.replace(/\/+/g, '/');
  } else {
    return getReverseRoute(cleanPath);
  }
};
---

<a href={getTargetLink()} class="lang-toggle" title={`Switch to ${targetLabel}`}>
  <Image 
    loading="eager"
    class="flag" 
    src={targetFlag} 
    alt={`Flag for ${targetLabel}`} 
    width={24} 
    height={24} 
  />
</a>

<style>
  .lang-toggle {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 50px;
    text-decoration: none;
    color: white;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(8px);
  }


  .flag {
    width: 20px;
    height: auto;
    object-fit: contain;
  }

  .lang-toggle:active {
    transform: scale(0.95);
  }
</style>