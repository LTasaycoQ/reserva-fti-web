---
const currentLocale = Astro.currentLocale || 'es';

const translations = {
  es: {
    form: {
      nombre: "Nombre",
      apellido: "Apellido",
      telefono: "Número Telefónico",
      email: "Email",
      mensaje: "Mensaje",
      enviar: "Enviar",
      enviando: "Enviando..."
    },
    contact: {
      titulo: "Contacto Hotel:",
      reservaciones: "Reservaciones:",
      recepcion: "Recepción:"
    },
    alerts: {
      successTitle: "¡Enviado!",
      successText: "Tu mensaje ha sido enviado con éxito.",
      errorTitle: "Error",
      errorText: "No pudimos enviar el mensaje. Intenta de nuevo."
    }
  },
  en: {
    form: {
      nombre: "Name",
      apellido: "Last Name",
      telefono: "Phone Number",
      email: "Email",
      mensaje: "Message",
      enviar: "Send",
      enviando: "Sending..."
    },
    contact: {
      titulo: "Hotel Contact:",
      reservaciones: "Reservations:",
      recepcion: "Reception:"
    },
    alerts: {
      successTitle: "Sent!",
      successText: "Your message has been sent successfully.",
      errorTitle: "Error",
      errorText: "We couldn't send the message. Please try again."
    }
  }
};

const t = translations[currentLocale as keyof typeof translations];
---

<section class="contacto-section">
  <div class="container-form">
    <form class="form-contacto">
      <input 
        name="Nombre" 
        placeholder={t.form.nombre} 
        type="text" 
        required 
      />
      <input
        name="Apellido"
        placeholder={t.form.apellido}
        type="text"
        required
      />
      <input
        required
        name="Telefono"
        placeholder={t.form.telefono}
        type="number"
      />
      <input 
        name="Email" 
        placeholder={t.form.email} 
        type="email" 
        required 
      />
      <textarea 
        name="Mensaje" 
        placeholder={t.form.mensaje}
      ></textarea>
      <button type="submit">{t.form.enviar}</button>
    </form>
  </div>
  <div class="container-info">
    <ul class="lista-contacto">
      <li>
        <i class="bi bi-geo-alt-fill"></i>Calle Union 184, Cusco, Perú
      </li>
      <li>
        <i class="bi bi-telephone-fill"></i>{t.contact.reservaciones} +51 987 945 817
      </li>
      <li>
        <i class="bi bi-telephone-fill"></i>{t.contact.recepcion} +51 997 564
      </li>
      <li class="contacto-titulo">{t.contact.titulo}</li>
      <li><i class="bi bi-telephone-fill"></i>(51 - 84) 887-72950</li>
      <li><i class="bi bi-envelope"></i>reservas@TerraAndinaHotel.com</li>
    </ul>
    <div class="mapouter">
      <div class="gmap_canvas">
        <iframe
          title="Mapa de ubicación Terra Andina Hotel"
          class="mapa-iframe"
          id="gmap_canvas"
          src="https://maps.google.com/maps?q=Calle%20Union%20184%20Cusco&t=&z=13&ie=UTF8&iwloc=&output=embed"
          loading="lazy"
        >
        </iframe>
      </div>
    </div>
  </div>
</section>

<script is:inline src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script is:inline define:vars={{ t }}>
  const URL_GOOGLE = "https://script.google.com/macros/s/AKfycbzjjjlNFhOsF0W0Xvcj8V1NZefde-qLnyPtICkRbkeIoD3j4cg2j5dQv6XE3zeUfrTp/exec";
  const form = document.querySelector(".form-contacto");
  
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const btn = form.querySelector("button");
    const originalText = btn.innerText;
    btn.innerText = t.form.enviando;
    btn.disabled = true;
    
    const formData = new FormData(form);
    const data = {
      Nombre: formData.get("Nombre"),
      Apellido: formData.get("Apellido"),
      Telefono: formData.get("Telefono"),
      Email: formData.get("Email"),
      Mensaje: formData.get("Mensaje"),
    };
    
    try {
      await fetch(URL_GOOGLE, {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify(data),
      });
      
      Swal.fire({
        title: t.alerts.successTitle,
        text: t.alerts.successText,
        icon: "success",
        confirmButtonColor: "#C08E1F"
      });
      
      form.reset();
    } catch (error) {
      Swal.fire({
        title: t.alerts.errorTitle,
        text: t.alerts.errorText,
        icon: "error",
      });
    } finally {
      btn.innerText = originalText;
      btn.disabled = false;
    }
  });
</script>