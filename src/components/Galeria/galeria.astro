---
interface Section {
  id: number;
  image: string;
  title: string;
}

const currentLocale = Astro.currentLocale || 'es';

const translations = {
  es: {
    title: "GALERÍA DE FOTOS",
    no_images: "No se encontraron imágenes en la galería."
  },
  en: {
    title: "PHOTO GALLERY",
    no_images: "No images found in the gallery."
  }
};

const t = translations[currentLocale as keyof typeof translations];
const roomsImport = import.meta.glob("../../content/galeria.md", { eager: true });
const roomsData = Object.values(roomsImport) as any[];
const sections: Section[] = roomsData[0]?.frontmatter?.fotos ?? [];
---

<section class="w-full flex flex-col justify-center items-center mx-auto px-4 py-12">
    <div class="w-[90%]">
        <div>
            <h1 class="title text-[34px] text-gray-600 mb-8 font-semibold">{t.title}</h1>        
        </div>
    </div>
    
    <div 
        id="galeria-fotos" 
        class="pt-[30px] grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 justify-items-center w-[90%]"
        data-sections={JSON.stringify(sections)}
    >
        {
            sections.length > 0 ? (
                sections.map((foto, index) => (
                    <div 
                        class="item-galeria group relative overflow-hidden rounded-[20px] shadow-lg w-full  cursor-pointer"
                        data-index={index}
                    >
                        <img 
                            src={foto.image} 
                            alt={foto.title} 
                            class="img w-[100%]  bg-gray-400 object-cover transition-transform duration-700 group-hover:scale-110"
                            loading="lazy"
                        />
                        <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                            <i class="bi bi-zoom-in text-white text-3xl"></i>
                        </div>
                    </div>
                ))
            ) : (
                <p>{t.no_images}</p>
            )
        }
    </div>

    <dialog id="modal-galeria" class="backdrop:bg-black/95 p-0 border-none bg-transparent max-w-full max-h-full w-full h-full fixed inset-0 overflow-hidden">
        <div class="flex flex-col items-center justify-center w-full h-full relative p-4">
            
            <button onclick="document.getElementById('modal-galeria').close()" id="close-modal" class="absolute top-6 right-6 text-white bg-white/10 hover:bg-white/30 backdrop-blur-md rounded-full w-12 h-12 flex items-center justify-center cursor-pointer text-4xl transition-all z-[70]">
                &times;
            </button>
            
            <div class="flex items-center justify-between w-full h-full max-w-7xl px-4 gap-4">
                
                <button id="prev-btn" class="text-white bg-black/40 hover:bg-black/60 rounded-full p-3 cursor-pointer transition-all z-[60]">
                    <i class="bi bi-caret-left-fill text-3xl"></i>
                </button>

                <div class="flex flex-col items-center gap-4 flex-1 h-full justify-center">
                    <img 
                        id="modal-img" 
                        src="" 
                        alt="" 
                        class="max-w-full max-h-[75vh] object-contain rounded-md shadow-2xl transition-transform duration-300 cursor-zoom-in" 
                    />
                </div>

                <button id="next-btn" class="text-white bg-black/40 hover:bg-black/60 rounded-full p-3 cursor-pointer transition-all z-[60]">
                    <i class="bi bi-caret-right-fill text-3xl"></i>
                </button>
            </div>
        </div>
    </dialog>
</section>

<style>
    @reference "tailwindcss";

    .item-galeria {
        animation: slideUp 0.5s ease-out forwards;
    }

    dialog[open] #modal-img {
        animation: scaleIn 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    .img-magnified {
        transform: scale(1.4);
        cursor: zoom-out !important;
    }

    body:has(dialog[open]) {
        overflow: hidden;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.85); }
        to { opacity: 1; transform: scale(1); }
    }
</style>

<script is:inline>
    const modal = document.getElementById('modal-galeria');
    const modalImg = document.getElementById('modal-img');
    const galleryContainer = document.getElementById('galeria-fotos');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    const images = JSON.parse(galleryContainer.dataset.sections);
    let currentIndex = 0;

    function updateModal(index) {
        if (index < 0) index = images.length - 1;
        if (index >= images.length) index = 0;
        
        currentIndex = index;
        const data = images[currentIndex];
        
        modalImg.src = data.image;
        modalImg.alt = data.title;
        
        modalImg.classList.remove('img-magnified');
    }

    galleryContainer.addEventListener('click', (e) => {
        const item = e.target.closest('.item-galeria');
        if (item) {
            const index = parseInt(item.dataset.index);
            updateModal(index);
            modal.showModal();
        }
    });

    prevBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        updateModal(currentIndex - 1);
    });

    nextBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        updateModal(currentIndex + 1);
    });

    modalImg.addEventListener('click', (e) => {
        e.stopPropagation();
        modalImg.classList.toggle('img-magnified');
    });
   

    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.close();
    });

    document.addEventListener('keydown', (e) => {
        if (!modal.open) return;
        
        if (e.key === 'ArrowLeft') updateModal(currentIndex - 1);
        if (e.key === 'ArrowRight') updateModal(currentIndex + 1);
        if (e.key === 'Escape') modal.close();
    });
</script>