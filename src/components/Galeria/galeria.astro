---
interface Section {
  image: string;
  title: string;
  cat: string;
}

const currentLocale = Astro.currentLocale || 'es';

const translations = {
  es: {
    title: "GALERIA DE FOTOS"
  },
  en: {
    title: "PHOTO GALLERY"
  }
};
const t = translations[currentLocale as keyof typeof translations];
const roomsImport = import.meta.glob("../../content/galeria.md", { eager: true });
const roomsData = Object.values(roomsImport) as any[];
const sections: Section[] = roomsData[0]?.frontmatter?.fotos ?? [];
---
<section class="w-full flex flex-col justify-center items-center mx-auto px-4 py-12">
   <div class="w-[90%]">
        <div>
            <h1 class="title text-[34px] text-gray-600 mb-8 font-semibold">{t.title}</h1>        
        </div>

        <div class="flex flex-wrap hidden justify-start gap-4 mb-12">
            <button onclick="filtrar('todos')" class="btn-filtro active">Todos</button>
            <button onclick="filtrar('hoteles')" class="btn-filtro">Hoteles</button>
            <button onclick="filtrar('comida')" class="btn-filtro">Gastronomía</button>
            <button onclick="filtrar('masajes')" class="btn-filtro">Masajes</button>
        </div>
    </div>
    <div id="galeria-fotos" class="pt-[30px] grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-8 justify-items-center w-[90%] lg:w-[90%]">
        {
            sections.length > 0 ? (
                sections.map((foto) => (
                    <div class={`item-galeria ${foto.cat} group relative overflow-hidden rounded-[12px] shadow-lg w-full aspect-square cursor-pointer`}>
                        <img 
                            src={foto.image} 
                            alt={foto.title} 
                            class="img w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                            loading="lazy"
                        />
                        <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                            <i class="bi bi-zoom-in text-white text-3xl"></i>
                        </div>
                    </div>
                ))
            ) : (
                <p>No se encontraron imágenes en la galería.</p>
            )
        }
    </div>

    <dialog id="modal-galeria" class="backdrop:bg-black/95 p-0 border-none bg-transparent max-w-full max-h-full w-full h-full fixed inset-0 overflow-hidden">
        <div class="flex flex-col items-center justify-center w-full h-full relative p-4">
            <button onclick="document.getElementById('modal-galeria').close()" class="absolute top-6 right-6 text-white bg-white/10 hover:bg-white/30 backdrop-blur-md rounded-full w-12 h-12 flex items-center justify-center cursor-pointer text-4xl transition-all z-[60]">
                &times;
            </button>
            
            <div class="flex items-center justify-center max-w-6xl w-full h-[85vh] overflow-hidden">
                <img 
                    id="modal-img" 
                    src="" 
                    alt="" 
                    class="max-w-full max-h-full object-contain rounded-md shadow-2xl transition-transform duration-300 cursor-zoom-in" 
                    onclick="toggleZoom(this)"
                />
            </div>
        </div>
    </dialog>
</section>

<style>
    @reference "tailwindcss";

    .btn-filtro {
        @apply px-6 py-2 border-2 border-[#A71E1F] text-[#A71E1F] font-bold rounded-full transition-all duration-300 cursor-pointer;
    }

    .btn-filtro.active {
        @apply bg-[#A71E1F] text-white shadow-lg shadow-[#A71E1F]/50;
    }

    .item-galeria {
        animation: slideUp 0.5s ease-out forwards;
    }

    dialog[open] #modal-img {
        animation: scaleIn 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    .img-magnified {
        transform: scale(1.5);
        cursor: zoom-out !important;
    }

    body:has(dialog[open]) {
        overflow: hidden;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.7); }
        to { opacity: 1; transform: scale(1); }
    }
</style>

<script is:inline>
    const modal = document.getElementById('modal-galeria');
    const modalImg = document.getElementById('modal-img');

    document.getElementById('galeria-fotos').addEventListener('click', function(e) {
        const target = e.target.closest('.item-galeria');
        if (target) {
            const img = target.querySelector('img');
            modalImg.src = img.src;
            modalImg.classList.remove('img-magnified');
            modal.showModal(); 
        }
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.close();
    });

    function toggleZoom(img) {
        img.classList.toggle('img-magnified');
    }

    function filtrar(categoria) {
        const items = document.querySelectorAll('.item-galeria');
        const botones = document.querySelectorAll('.btn-filtro');

        botones.forEach(btn => {
            btn.classList.remove('active');
            const btnText = btn.innerText.toLowerCase();
            if (categoria === 'todos' && btnText === 'todos') btn.classList.add('active');
            else if (categoria !== 'todos' && btnText.includes(categoria.toLowerCase())) btn.classList.add('active');
        });

        items.forEach(item => {
            if (categoria === 'todos' || item.classList.contains(categoria)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
</script>