---
import { Image } from "astro:assets";
import RoomIncludes from "./RoomIncludes.astro";
import { getRoomsData } from "../../content/RoomClasic/service";

// Glob de todas las imágenes de rooms en src/assets/rooms/
const roomImages = import.meta.glob<{ default: ImageMetadata }>(
  '../../assets/rooms/*.webp',
  { eager: true }
);

const currentLocale = Astro.currentLocale || 'es';
const roomsData = getRoomsData(currentLocale);

// Helper: convierte "/images/rooms/Clasica-mat-1.webp" → ImageMetadata
function getImage(path: string): ImageMetadata {
  const filename = path.split('/').pop();
  const key = `../../assets/rooms/${filename}`;
  return roomImages[key]?.default;
}
---

{
  roomsData.map((room) => {
    const half = Math.ceil(room.services.length / 2);
    const col1 = room.services.slice(0, half);
    const col2 = room.services.slice(half);
    return (
      <section class="mb-20 flex flex-col justify-center items-center text-center">
        <h2 class="text-gray-700 position__title title text-[1.8rem]">
          {room.title}
        </h2>
        <div class="w-[80%] max-md:w-[100%] p-[15px] flex justify-center gap-[30px] items-center mb-8">
          <button aria-label="Anterior" class="prevBtn">
            <i class="bi bi-caret-left-fill bg-red-900 text-white p-[8px] rounded-full text-[18px]" />
          </button>
          <div class="slider__rooms flex justify-start items-center overflow-x-scroll scroll-smooth gap-[20px] max-md:w-[100%] w-[78%]">
            {room.images.map((img) => (
              <Image
                src={getImage(img)}
                alt={room.title}
                width={384}
                height={280}
                class="w-[24em]"
                draggable={false}
                loading="lazy"
              />
            ))}
          </div>
          <button aria-label="Siguiente" class="nextBtn">
            <i class="bi bi-caret-right-fill bg-red-900 text-white p-[8px] rounded-full text-[18px]" />
          </button>
        </div>
        <div class="lista__detail w-full flex justify-center items-center">
          <RoomIncludes />
        </div>
        {room.titleService && (
          <h3 class="text-gray-700 text-[1.4rem] title">{room.titleService}</h3>
        )}
        {room.services.length > 0 && (
          <div class="lista__detail text-[18px] flex flex-wrap gap-[40px] justify-center items-center">
            <ul class="flex flex-col justify-center max-lg:w-[85%] items-start">
              {col1.map((item) => (
                <li class="flex gap-[10px] text-start items-center justify-center text-gray-600">
                  <i class="text-[#9E2222] text-[18px] bi bi-check-lg" />
                  {item}
                </li>
              ))}
            </ul>
            <ul class="flex flex-col justify-center max-lg:w-[85%] items-start">
              {col2.map((item) => (
                <li class="flex gap-[10px] items-center text-start justify-center text-gray-600">
                  <i class="text-[#9E2222] text-[18px] bi bi-check-lg" />
                  {item}
                </li>
              ))}
            </ul>
          </div>
        )}
      </section>
    );
  })
}

<style>
  .lista__detail {
    margin-bottom: 50px;
    margin-top: 40px;
  }
  .slider__rooms {
    cursor: grab;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .slider__rooms::-webkit-scrollbar {
    display: none;
  }
  .slider__rooms img {
    pointer-events: none;
    user-select: none;
  }
</style>